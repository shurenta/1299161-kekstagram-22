(()=>{var e={388:()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector("#upload-file");t.addEventListener("change",(()=>{const r=document.querySelector(".img-upload__preview").querySelector("img"),o=t.files[0],n=o.name.toLowerCase();if(e.some((e=>n.endsWith(e)))){const e=new FileReader,t=()=>{r.src=e.result};e.addEventListener("load",t),e.readAsDataURL(o)}}))}},t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}(()=>{"use strict";const e=e=>"Escape"===e.key,t=document.querySelector(".comments-loader"),o=()=>{const e=document.querySelectorAll(".social__comment");document.querySelector(".social__amount").textContent=e.length},n=document.querySelector(".social__comments"),c=()=>{const e=document.querySelector("body");document.querySelector(".big-picture").classList.add("hidden"),e.classList.remove("modal-open"),document.removeEventListener("keydown",s),t.classList.remove("hidden"),l()},s=t=>{e(t)&&c()},l=()=>{n.innerHTML=""};document.querySelector(".big-picture__cancel").addEventListener("click",c);const d=document.querySelector(".scale__control--smaller"),i=document.querySelector(".scale__control--bigger"),a=document.querySelector(".scale__control--value"),u=document.querySelector(".img-upload__preview").querySelector("img");a.value="100%";let m=Number.parseInt(a.value);i.disabled=!0;const y=()=>{u.style.transform="scale("+m/100+")",d.disabled=m<=25,i.disabled=m>=100,a.value=m+"%"};d.addEventListener("click",(()=>{i.disabled=!1,m-=25,y()})),i.addEventListener("click",(()=>{d.disabled=!1,m+=25,y()}));const v=document.querySelector(".effect-level"),S=document.querySelector(".effect-level__slider"),g=document.querySelector(".effect-level__value"),p=document.querySelector("#upload-file"),b=document.querySelector("#upload-cancel"),q=document.querySelector(".img-upload__overlay"),h=document.querySelector(".effects__list"),L=document.querySelector("body"),f=document.querySelector(".text__hashtags"),k=document.querySelector(".text__description");p.addEventListener("click",(()=>{q.classList.remove("hidden"),L.classList.add("modal-open"),v.classList.add("hidden"),document.addEventListener("keydown",C)}));const E=()=>{q.classList.add("hidden"),L.classList.remove("modal-open"),document.removeEventListener("keydown",C),u.style="",a.value="100%",m=Number.parseInt(a.value),d.disabled=!1,i.disabled=!0,S.noUiSlider.off(),f.value="",k.value=""};b.addEventListener("click",E);const C=t=>{e(t)&&E()};noUiSlider.create(S,{range:{min:0,max:1},start:1,step:.1,connect:"lower"});const x={none:{sliderSettings:{},getFilterStyle:()=>u.style=""},chrome:{sliderSettings:{range:{min:0,max:1},start:1,step:.1},getFilterStyle:e=>"grayscale("+Number(e)+")"},sepia:{sliderSettings:{range:{min:0,max:1},start:1,step:.1},getFilterStyle:e=>"sepia("+Number(e)+")"},marvin:{sliderSettings:{range:{min:0,max:100},start:100,step:1},getFilterStyle:e=>"invert("+Number(e)+"%)"},phobos:{sliderSettings:{range:{min:0,max:3},start:3,step:.1},getFilterStyle:e=>"blur("+Number(e)+"px)"},heat:{sliderSettings:{range:{min:1,max:3},start:3,step:.1},getFilterStyle:e=>"brightness("+Number(e)+")"}};h.addEventListener("change",(e=>{S.noUiSlider.off();const t=e.target.value;S.noUiSlider.updateOptions(x[t].sliderSettings),v.classList.remove("hidden"),"none"===t&&v.classList.add("hidden"),S.noUiSlider.on("update",((e,r,o)=>{g.value=o[r],u.style.filter=x[t].getFilterStyle(g.value)}))}));const w=document.querySelector(".text__hashtags"),N=document.querySelector(".text__description");w.addEventListener("input",(()=>{const e=w.value.length,t=w.value.toLowerCase().split(" ");for(let r of t){const o=/^#[a-zA-Z0-9]+/;if(e<2){w.setCustomValidity("Ещё "+(2-e)+" симв."),w.style.borderColor="red";break}if(w.style.borderColor="black","#"!==r[0]){w.setCustomValidity("Имя должно начинаться с #"),w.style.borderColor="red";break}if(w.style.borderColor="black",!o.test(r)){w.setCustomValidity("Должны быть только цифры или буквы"),w.style.borderColor="red";break}if(r.length>20){w.setCustomValidity("Удалите лишние "+(r.length-20)+" симв."),w.style.borderColor="red";break}if(w.style.borderColor="black",t.length>5){w.setCustomValidity("может быть только 5ть хэштегов"),w.style.borderColor="red";break}w.style.borderColor="black",w.setCustomValidity("")}e:for(let e=0;e<t.length;e++)for(let r=e+1;r<t.length;r++){if(t[e]===t[r]){w.style.borderColor="red",w.setCustomValidity("дубликат");break e}w.style.borderColor="black"}w.reportValidity()})),w.addEventListener("focus",(()=>{document.removeEventListener("keydown",C)})),w.addEventListener("blur",(()=>{document.addEventListener("keydown",C)})),N.addEventListener("focus",(()=>{document.removeEventListener("keydown",C)})),N.addEventListener("blur",(()=>{document.addEventListener("keydown",C)}));const F=document.querySelector("main"),V=()=>{const e=document.querySelector("#error").content.cloneNode(!0);F.appendChild(e),F.querySelector(".error__button").addEventListener("click",A),document.addEventListener("keydown",U)},A=()=>{document.querySelector(".error").remove(),document.removeEventListener("keydown",U)},U=t=>{e(t)&&(A(),document.removeEventListener("keydown",U))},j=()=>{document.querySelector(".success").remove(),document.removeEventListener("keydown",D)},D=t=>{e(t)&&(j(),document.removeEventListener("keydown",D))};var I;F.addEventListener("click",(e=>{"error"===e.target.className&&A(),"success"===e.target.className&&j()})),I=E,document.querySelector(".img-upload__form").addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(e.target);fetch("https://22.javascript.pages.academy/kekstagram",{method:"POST",body:t}).then((e=>{e.ok?((()=>{const e=document.querySelector("#success").content.cloneNode(!0);F.appendChild(e),F.querySelector(".success__button").addEventListener("click",j),document.addEventListener("keydown",D)})(),I()):(V(),E())})).catch((()=>{V(),E()}))})),r(388);const M=e=>{const t=document.querySelector(".pictures"),r=document.querySelector("#picture").content,o=document.createDocumentFragment();e.forEach((({url:e,comments:t,likes:n,id:c})=>{const s=r.cloneNode(!0),l=s.querySelector(".picture__img");l.src=e,l.setAttribute("data-id",c),s.querySelector(".picture__comments").textContent=t.length,s.querySelector(".picture__likes").textContent=n,o.appendChild(s)})),t.appendChild(o)},O="img-filters__button--active",R=()=>{document.querySelectorAll(".picture").forEach((e=>{e.parentNode.removeChild(e)}))},T=fetch("https://22.javascript.pages.academy/kekstagram/data").then((e=>e.json()));T.then(M),T.then((e=>{const r=r=>{const c=(t=>{const r=t.target.dataset.id;return e.find((e=>e.id===Number(r)))})(r);(e=>{document.querySelector(".big-picture__img").querySelector("img").src=e.url,document.querySelector(".social__caption").textContent=e.description})(c);const l=document.querySelector(".big-picture"),d=document.querySelector("body");l.classList.remove("hidden"),d.classList.add("modal-open"),(e=>{const t=e.target.nextElementSibling.querySelector(".picture__likes");document.querySelector(".likes-count").textContent=t.textContent})(r),(e=>{const t=document.querySelector(".big-picture").querySelector(".comments-count"),r=e.comments;t.textContent=r.length})(c),(e=>{const r=e.comments,c=document.querySelector("#comment").content,s=document.createDocumentFragment();let l=0,d=5;const i=()=>{r.slice(l,d).forEach((({avatar:e,message:t,name:r})=>{const o=c.cloneNode(!0),n=o.querySelector(".social__picture");n.src=e,n.alt=r,o.querySelector(".social__text").textContent=t,s.appendChild(o)})),n.appendChild(s);const e=document.querySelectorAll(".social__comment");Number(e.length)===Number(r.length)&&t.classList.add("hidden"),o()};i(),t.addEventListener("click",(()=>{l+=5,d+=5,i()}))})(c),o(),document.addEventListener("keydown",s)};document.querySelector(".pictures").addEventListener("click",(e=>{"picture__img"===e.target.className&&r(e)}))})),T.then((e=>{document.querySelector(".img-filters--inactive").classList.remove("img-filters--inactive");const t=document.querySelectorAll(".img-filters__button"),r=_.debounce((t=>{switch(t.target.id){case"filter-random":return(()=>{const t=e.filter((()=>1));t.sort((()=>.5-Math.random())),R(),M(t.slice(t,10))})();case"filter-discussed":return(()=>{R();const t=e.filter((()=>1));t.sort(((e,t)=>e.comments<t.comments?1:-1)),M(t)})();case"filter-default":return R(),void M(e)}}),500);t.forEach((e=>{e.addEventListener("click",(t=>{document.querySelector(`.${O}`).classList.remove(O),e.classList.add(O),r(t)}))}))}))})()})();
//# sourceMappingURL=main.bundle.js.map